# Baseline MTP (Uniform Weighting)
# 균등 가중치 기반 표준 MTP (비교 기준선)
# 프로덕션 설정 (VESSL A100 4-GPU)

# 프로젝트 정보
project:
  name: weighted-mtp
  version: "2.0.0"

# 실험 메타정보
experiment:
  name: baseline-mtp
  description: "Baseline MTP with uniform weights (all tokens weight=1.0)"
  stage: baseline
  tags:
    - baseline
    - uniform-weight
    - production

# 모델 설정
models:
  policy:
    name: meta-llama-mtp
    path: storage/models/meta-llama-mtp
    tokenizer_path: storage/models/meta-llama-mtp/tokenizer
    params:
      dim: 4096
      n_layers: 32
      n_heads: 32
      n_future_tokens: 4
      intermediate_size: 11008
      rope_theta: 10000.0
      vocab_size: 32000
    dtype: bfloat16

# 데이터셋 설정
dataset:
  name: codecontests
  train: storage/datasets/codecontests/processed/train.jsonl
  validation: storage/datasets/codecontests/processed/valid.jsonl
  max_length: 2048

# 데이터 샘플링
data_sampling:
  n_samples: 150000
  balance_correct: false
  correct_ratio: 1.0  # Baseline은 정답만 학습
  curriculum_learning: true
  difficulty_bins:
    easy: [6, 7]
    medium: [8, 9]
    hard: [10, 25]
  curriculum_schedule:
    - epoch_range: [0.0, 0.3]
      difficulty_weights:
        easy: 0.7
        medium: 0.3
        hard: 0.0
    - epoch_range: [0.3, 0.7]
      difficulty_weights:
        easy: 0.3
        medium: 0.5
        hard: 0.2
    - epoch_range: [0.7, 1.0]
      difficulty_weights:
        easy: 0.1
        medium: 0.4
        hard: 0.5
  seed: 42

# 학습 설정 (A100 4-GPU 최적화)
training:
  n_epochs: 3.0
  batch_size: 8  # Per GPU (effective = 16 with 4 GPUs)
  gradient_accumulation_steps: 2  # Effective batch size = 64
  learning_rate: 1.0e-5
  max_grad_norm: 0.5
  log_interval: 1

# 체크포인트
checkpoint:
  save_dir: storage/checkpoints/baseline/${experiment.name}
  save_checkpoint_every: 0.5
  save_best: true
  save_final: true
  save_total_limit: 2

# 런타임 설정
runtime:
  device: cuda
  seed: 42
  mixed_precision: true

# 분산학습 설정
distributed:
  fsdp:
    sharding_strategy: FULL_SHARD
    mixed_precision: true
    cpu_offload: false

# 스토리지
storage:
  root: storage
  models_dir: storage/models
  datasets_dir: storage/datasets
  checkpoints_dir: storage/checkpoints

# MLflow 추적
mlflow:
  tracking_uri: "http://13.50.240.176"
  experiment: "weighted-mtp/production"
  s3_artifacts: "s3://wmtp/mlflow-artifacts"

# 로깅
logging:
  level: INFO
  format: "%(asctime)s [%(levelname)s] [%(name)s] %(message)s"
