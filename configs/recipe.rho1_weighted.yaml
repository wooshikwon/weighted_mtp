# 실험 3: Rho-1 Weighted

experiment:
  name: rho1-weighted
  description: "Token weighting based on reference model loss difference"

dataset:
  name: codecontests
  split:
    train: storage/datasets_v2/codecontests/processed/train.jsonl
    validation: storage/datasets_v2/codecontests/processed/valid.jsonl
    test: storage/datasets_v2/codecontests/processed/test.jsonl
  max_length: 2048

training:
  stages:
    - stage1_trunk_pretrain: false
    - stage2_weighted_training: true

  stage2:
    use_weighting: true
    batch_size: 4
    gradient_accumulation_steps: 4
    learning_rate: 1.0e-5
    num_epochs: 3
    warmup_steps: 100

    # Rho-1 weighting (Reference model 기반 - WMTP와 다른 방식)
    weighting_method: rho1  # rho1 (reference loss) vs wmtp (td error)
    reference_model: ref-sheared-llama-2.7b
    temperature: 1.0  # Rho-1 temperature
    weight_clip_min: 0.1
    weight_clip_max: 5.0
    kl_monitoring: true

evaluation:
  metrics: [loss, perplexity, reference_loss_diff, weight_entropy, kl_divergence]
  pass_at_k: [1, 5, 10]
